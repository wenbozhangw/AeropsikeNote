# service配置参数

## 一、参数配置
| name | Default | tag               | Comment                        |
| ----------------------------- | ------- | ----------------- | ------------------------------ |
| advertise-ipv6                | false   | enterprise/static | 需要心跳v3。设置为true启动IPv6 |
| ~~allow-inline-transactions~~ | true    | removed:3.11 | 默认情况下，内存中的读操作由服务线程直接处理，而不是卸载转移到操作队列，然后由操作线程拾取。将 allow-inline-transactions设置为false将强制所有操作分配到一个操作队列。这在有限的网络队列和/或服务线程的环境中很有帮助。要在整个集群中禁用内联操作：`asadm -e "asinfo -v 'set-config:context=service;allow-inline-transactions=false'"` |
| auto-pin | none | static | 这个配置控制CPU固定的不同选项。在 *4.7* 之前的Aerospike版本中使用此配置时，服务线程和处理队列都不能在配置文件中配置；两者都默认为cpu的数量。在Aerospike 4.7+中，可以配置服务线程，但如果该配置生效，则必须是cpu数量的倍数。可能的值是：<br />- `none`        依赖于Linux的 [irqbalance](irqbalance/irqbalance.md)。<br />- `cpu`          CPU固定 - Aerospike控制所有NIC队列中断的亲缘性。<br />- `numa`        CPU和NUMA固定 - 将 `asd` 的内存和CPU使用率限制为单个NUMA节点。<br />- `adq`          应用程序设备队列固定 - Aerospike根据与相应客户端连接关联的NIC队列将客户端请求分派给CPU。需要启用了 ADQ 的NIC 和 NIC 的手动配置。<br />`cpu`和`numa`需要Linux内核 3.19+。默认来说需要 Ubuntu 15.04+， Debian 8 (3.16)，CentOS 7 (3.10)。如果需要，Linux内核必须升级。`adq`需要Linux内核 4.12+。取消任何自动固定后，需要重新启动以恢复中断的系统默认值。将 `auto-pin` 设置为 `cpu`时，Aerospike 4.7之前的版本不允许在配置文件中设置事务队列和服务现场。两者将被强制为CPU的数量 - 这也是 Aerospike版本3.12+中的默认值。 Aerospike 4.7+版本允许设置服务线程，但要求配置的数量必须是CPU数量的倍数。使用这些配置之前，请联系Aerospike支持以获取建议和基准详细信息。<br />**注意**：网络接口硬件应支持MSI。MSI通过PCI总线将终端从外围设备（例如NIC）发送到CPU。较老的硬件有专门的线路，因此CPU和设备之间的任何数据交换通过PCI总线，中断通过一个单独的路径处理。但最近几天，一切都通过PCI总线。不支持MSI的网络接口将assert如下:<br />`FAILED ASSERTION (hardware): (hardware.c:1087) interface eth0 does not support MSIs`<br />NIC队列与CPU核的比例也必须大于1/4。以下消息将被记录到控制台，服务器将不会启动:<br />`WARNING (hardware): (hardware.c:1605) eth0 has very few NIC queues; only 8 out of 32 CPUs handle(s) NIC interrupts` |
| batch-index-threads | #cpu | dynamic | 批处理索引响应工作线程数。在版本3.12+中，默认情况下将其设置为可用的CPU内核数。在以前的版本中，默认值为4。每个线程都有自己的队列。这些线程只处理通过套接字将批处理响应缓冲区发送回客户端。值范围：1-256。<br />动态设置 batch-index-threads 为16：<br />`asinfo -v "set-config:context=service;batch-index-threads=16"`<br />Tip: 3.12版本之前允许最大值为64。 |
| batch-max-buffers-per-queue | 255 | dynamic | 每个批处理索引队列中被标记为已满之前允许的128KB响应缓冲区的数量。批处理索引队列（每个批处理索引线程一个）可以具有多于`batch-max-buffers-per-queue`缓冲区，但是直到它低于该数量，它才会接收任何新的批处理。当所有的队列都大于`batch-max-buffers-per-queue`时，新的批处理请求将被拒绝，并且将在服务器上记录错误："*Failed to find active batch queue that is not full*."。<br />动态设置batch-max-buffers-per-queue为512：<br />`asinfo -v "set-config:context=service;batch-max-buffers-per-queue=512"` |
| batch-max-requests | 5000 | dynamic | 每个节点允许的最大key个数。<br />动态设置batch-max-requests为6000：<br />`asinfo -v "set-config:context=service;batch-max-requests=6000"` |
| batch-max-unused-buffers | 256 | dynamic | 缓冲池中允许的最大128KB响应缓冲区的个数。如果达到限制，则已完成的缓冲区将在批处理请求结束时销毁。对于大量的批量工作负载，建议增加这个配置参数，以避免不必要的破坏和重新创建缓冲区，这会影响CPU负载。<br />动态设置 batch-max-unused-buffers为512：<br />`asinfo -v "set-config:context=service;batch-max-unused-buffers=512"` |
| ~~batch-priority~~ | 200 | removed:4.4/dynamic | 生成前的顺序读取数。数字越大，优先级越高。仅适用于旧的batch direct协议，该协议已在版本4.4中删除。<br />动态设置 batch-priority为300：<br />`asinfo -v "set-config:context=service;batch-priority=300"` |
| batch-threads | 4 | removed:4.4/dynamic | batch direct 工作线程的数量。batch direct是旧版的批处理协议。该线程处理完整的批处理请求。所有批处理线程只有一个批处理队列。值范围：0-256。注意旧的batch direct协议已经在4.4版本移除。<br />动态设置 batch-threads 为8：<br />`asinfo -v "set-config:context=service;batch-threads=8"`<br />tips: 3.12版本之前最大值为 64。 |