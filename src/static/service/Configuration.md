# service 配置说明

## 一、配置说明
| name | default | Subcontext | Introduced | comment|
| ---- | ---- | ---- | ----| ----|
| _advertise-ipv6_ | false | | `Enterprise` Introduced : 3.10 | 需要 `heartbeat v3`。设置为 true 以启用 `IPv6` 。|
| auto-pin | none | | Introduced : 3.12 | 这个配置控制CPU固定的不同选项。在 *4.7* 之前的Aerospike版本中使用此配置时，服务线程和处理队列都不能在配置文件中配置；两者都默认为cpu的数量。在Aerospike 4.7+中，可以配置服务线程，但如果该配置生效，则必须是cpu数量的倍数。可能的值是：<br />- `none`        依赖于Linux的 [irqbalance](./irqbalance/irqBalance.md)。<br />- `cpu`          CPU固定 - Aerospike控制所有NIC队列中断的亲缘性。<br />- `numa`        CPU和NUMA固定 - 将 `asd` 的内存和CPU使用率限制为单个NUMA节点。<br />- `adq`          应用程序设备队列固定 - Aerospike根据与相应客户端连接关联的NIC队列将客户端请求分派给CPU。需要启用了 ADQ 的NIC 和 NIC 的手动配置。<br />`cpu`和`numa`需要Linux内核 3.19+。默认来说需要 Ubuntu 15.04+， Debian 8 (3.16)，CentOS 7 (3.10)。如果需要，Linux内核必须升级。`adq`需要Linux内核 4.12+。取消任何自动固定后，需要重新启动以恢复中断的系统默认值。将 `auto-pin` 设置为 `cpu`时，Aerospike 4.7之前的版本不允许在配置文件中设置事务队列和服务现场。两者将被强制为CPU的数量 - 这也是 Aerospike版本3.12+中的默认值。 Aerospike 4.7+版本允许设置服务线程，但要求配置的数量必须是CPU数量的倍数。使用这些配置之前，请联系Aerospike支持以获取建议和基准详细信息。<br />**注意**：网络接口硬件应支持MSI。MSI通过PCI总线将终端从外围设备（例如NIC）发送到CPU。较老的硬件有专门的线路，因此CPU和设备之间的任何数据交换通过PCI总线，中断通过一个单独的路径处理。但最近几天，一切都通过PCI总线。不支持MSI的网络接口将assert如下:<br />`FAILED ASSERTION (hardware): (hardware.c:1087) interface eth0 does not support MSIs`<br />NIC队列与CPU核的比例也必须大于1/4。以下消息将被记录到控制台，服务器将不会启动:<br />`WARNING (hardware): (hardware.c:1605) eth0 has very few NIC queues; only 8 out of 32 CPUs handle(s) NIC interrupts` |
| debug-allocations | none | | Introduced : 3.14 | 用于调试服务器上的内存分配的选项。 <br/> - `none` : 功能未启用。 <br/> - `transient` : 仅为临时分配启用的功能 - 不记录数据或元数据的 `overload` 内存。 <br/> - `persistent` : 仅对持久性分配启用的功能 - 记录数据或元数据的内存。 <br/> - `all` : 为所有分配启用功能。 <br/> 注意：启用 `debug-allocations` 后，服务器将在检测覆盖和（某些）两次 `double free` 时进行断言。此外，每个跟踪的分配都将产生 4 个额外字节的开销。为了更完整的调试`double free`，还可以启用 `indent-allocations`。 <br/> 警告：在启用 `debug-allocations` 的情况下运行了较长时间（通常为数月，但是如果频繁在 4.7 或 更高版本上使用扫描，则可能更快），内部存储器跟踪资源最终可能会耗尽。使用较旧的Aerospike server 3.14至4.4; 4.5.0.19之前的4.5.0版本; 4.5.1.15之前的4.5.1版本; 4.5.2.10之前的4.5.2版本; 4.5.3.10之前的4.5.3版本; 4.6 4.6.0.8之前的版本； 4.7.0.5之前的4.7），这种情况会导致崩溃。使用更新的Aerospike服务器（4.5.0版本4.5.0.19或更高版本; 4.5.1版本4.5.1.15或更高版本; 4.5.2版本4.5.2.10或更高版本; 4.5.3版本4.5.3.10或更高版本; 4.6版本4.6.0.8或更高版本； 4.7版本4.7.0.5或更高版本），这种情况仅导致无法检测到任何其他的内存泄漏。 |
| disable-udf-execution | false | | Introduced : 4.5.3.21 | 完全禁止执行 `User-Defined Functions (UDFs)`。 <br/> Example : <br/> `service {` <br/> `...` <br/> `disbale-udf-execution true` <br/> `...` <br/> `}` <br/> 注意：从以下版本开始可用：5.1.0.6、5.0.0.7、4.9.0.10、4.8.0.13、4.7.0.17、4.6.0.19、4.5.3.21。 |
| ~~dump-message-above-size~~ | 134217728 | | Removed : 3.7.2 | 大小（以字节为单位），超过该大小将在日志中打印收到的消息。 |
| ~~fabric-workers~~ | 16 | | Removed : 3.11.1.1 | 节点间通信的 fabric 线程数。替换为特定的配置：`channel-*-recv-threads`。 <br/> 对于服务器版本3.4.1及更高版本，此值最多可以设置为128。对于3.x和2.x的较早发行版，最多为64个。 |
| _feature-key-file_ | /etc/aerospike/features.conf | |`Enterprise` <br/> `required` <br/> Introduced : 4.0 (optional) 4.6 (required) | 包含已启用功能的数字前面功能密钥文件的位置，例如，版本 4.0 中引入的 strong consistency 模式。 <br/> 从 4.6 版本开始，无论是否启用注入强一致性之类的可选功能，所有 Enterprise Edition Server 节点都需要该文件。 <br/> 从 5.5 版本开始，可以指定多个 `feature-key-file` 指令（最多 32 个，必须是唯一的），从而可以从多个来源指定启用的功能。 <br/>  该指令具有以下可能的格式 ： <br/>  - `/path_to/featuresfile` : 功能密钥信息将从位于 `/path_to/featuresfile` 的文件中读取。从5.5版本开始，此路径还可以指定目录，在这种情况下，目录中的所有文件都必须是功能密钥文件。 <br/> - `vault:name_of_secret_in_vault` : （版本5.4及更高），将从存储在 `Vault` 中 named secret 存储中读取功能密钥信息。有关更多信息，请参阅 [Optional security with Vault integration](https://www.aerospike.com/docs/operations/configure/security/vault/index.html) 。 <br/> - `env:FEATURES` : (版本5.4及更高)将从指定的环境变量（例如FEATURES）中读取功能密钥信息。 <br/> 注意：仅在启动时才检查功能密钥的到期时间。功能密钥过期后，Aerospike服务器将继续运行，但无法使用过期的功能密钥 启动/重新启动 。 <br/> 警告：当前未使用功能密钥文件的企业被许可方在升级到 4.6 或更高版本之前，应联系 Aerospike 支持，以获取其功能密钥文件。 |
| group | | | | Group to run as |
| ~~hist-track-back~~ | 300 | | Removed : 5.1.0 | 缓存数据的总时间跨度（以秒为单位）。这用作启用/禁用直方图的标志。由于基于切片的大小进行四舍五入，因此报告的回溯值可能会在生成的命名空间 `hist-track-back` 处发生变化。当直方图开始时，其行数是基于 "back"/"slice" 的整数除法计算的。而且，虽然行数和切片大小与直方图一起存储，但 back size 却不是 - 在报告时，它是根据 (# rows) * (slice size) 重新计算的。因此，当直方图开始时，"back"有效地四舍五入为 "slice" 的最接近倍数，并且对应于直方图跟踪的实际时间窗口。 |
| ~~hist-track-slice~~ | 10 | | Removed : 5.1.0 | 缓存直方图数据的事件段（以秒为单位）。 |
| ~~hist-track-thresholds~~ | 1,8,64 | | Removed : 5.1.0 | 要用逗号分隔的存储桶(ms)值，必须为 2 的幂。例如：1、4、16、64。 <br/> Example : <br/> `hist-track-thresholds 1,2,4,8,16,32,64,128,256,512` |
| indent-allocations | false | | Introduced : 4.6 | `debug-allocations` 的额外选项，可以检测所有 `double free`。 <br/> 启用 `indent-allocations`，服务器将在检测到覆盖和所有`double free` 时断言。此外，每个跟踪的分配都将产生 256 个额外字节的开销。 |
| log-local-time | false | | Introduced : 3.7.0.1 | 默认情况下，Aerospike服务器日志的 GMT 标准时间带有时间戳。将此配置设置为 true 可将日志设置为本地时间戳（还显示 GMT 的偏移量）。 <br/> Example : `Dec 12 2015 18:52:39 GMT-0800: INFO (as): (as.c::494) service ready: soon there will be cake!` | 
| log-millis | false | | Introduced : 3.13 | 将此属性设置为true可以在日志文件中获得毫秒级的时间戳。 |
| node-id | N/A | | Introduced : 3.16.0.1 | 允许将节点的节点ID指定为 1 到 16 个字符（十六进制），以使其更友好或基于集群节点ID的分区分布。默认情况下，Aerospike 从配置的fabric port和服务器的网络接口 mac 地址（或者，如果配置，则为`node-id-interface`的mac地址）之一派生节点ID。 <br/> Example : <br/> `service {` <br/> `<...>` <br/> `node-id all` <br/> `<...>` <br/> `}` <br/> Tip : 当利用网络连接的影子设备配置（例如AWS上的EBS卷）时，明确指定节点ID很有用，它针对不同的实例重新附加，默认情况下，该实例的节点ID与原始实例的节点ID有所不同，因此会导致更多的迁移。对于具有易于理解的名称来引用集群的不同节点预计配置启用了 `strong-consistency` 的命名空间名单信息，这也很有用。 <br/> 注意：节点ID可以在整个集群中一次滚动地更改一个节点。 <br/> 警告：在启用 `strong-consistency` 的命名空间中更改 `node-id`将需要重新设置 [roster](https://www.aerospike.com/docs/reference/info/index.html?show-removed=1#roster) ,因此应该谨慎进行，以避免任何可用性 和/或 强一致性影响。 <br/> 从版本 3.16.0.1 开始，集群降不接受 2 个具有相同节点ID的节点。在集群中具有 2 个相同 node-id 的节点将导致错误和意外行为。特别是，集群大小和数据位置将不正确，并会导致性能不佳和异常的数据响应。 <br/> 配置选项 `node-id` 和 `node-id-interface` 是互斥的。 |
| node-id-interface | | | Introduced : 3.10 | 用于生成 `node-id` 的接口的名称。从 3.10 版开始，代替 `network-interface-name` 用于 `Node ID` 生成部分。 `Node ID` 用于确定集群中跨节点的分区分配的继承列表。 <br/> 警告：配置选项 `node-id` 和 `node-id-interface` 是互斥的。 |
| ~~nsup-startup-evict~~ | true | | Removed : 4.3.0 | 在启动时也要驱逐（而不是到期），以防止违反内存限制。 |
| ~~paxos-max-cluster-size~~ | 32 | | `unanimous` Removed : 3.10 (hb v3) / 3.14.0 | 在 3.10 版本及更高版本中针对 `heartbeat v3` 删除。集群中允许的最大节点数。设置新集群时最多可以设置为 127。默认值 32 允许最多 31 个节点（以避免不必要地使用网络带宽）。请参阅此页面，以了解更多有关如何增加已运行的集群的默认值的信息：[Increase Maximum Cluster Size](https://discuss.aerospike.com/t/how-to-add-more-than-31-nodes-to-a-cluster/2031) 。|
| paxos-single-replica-limit | 1 | | `unanimous` | 如果集群大小小于或等于此值，则集群中将仅保留一个数据副本（无副本）。仅在可用模式（AP）中。对于 `strong-consistency` 的命名空间，将被忽略。通常应在预期的群集大小下将几个节点配置为将在接近容量的情况下使用的群集（按照通常的容量大小准则），但将取决于集群的总大小以及集群中节点的满度。 <br/> Tip : 当集群由于故障突然丢一个节点，而其余节点无法容纳配置的 `replication-factor` 规定的副本时，此功能很有效。 <br/> 注意：由于当前无法动态配置此配置参数，因此请参考 `migration-fill-delay`，以防止在集群大小意外减小时迁移无法填充剩余节点。 |
| pidfile | /var/run/aerospike/asd.pid (in config) | | 用于存储守护程序的 PID 的文件。 <br/> Tip: 如果在不重新启动 Aerospike 服务的情况下手动移动了 PID 文件，则某些 Aerospike 状态检查可能会失败。如果需要更新位置路径，则需要更新 Aerospike 配置，更新 /etc/init.d 脚本，然后重新启动 Aerospike 服务以生成新的 PID 文件。 <br/> Note : 在系统环境中不需要。使用systemd时，在 aerospike.conf 文件的服务上下文中指定 pidfile 时，不会创建 PID 文件。如果在 aerospike.conf 文件中制定了 pidfile ，则日志将返回类似的警告 : `Oct 24 2018 21:20:55 GMT: WARNING (as): (as.c:337) will not write PID file in new-style daemon mode` |
| run-as-daemon | true | | | 如果为 true，则初始进程会派生到新进程（在后台运行）并退出。 <br/> Note : In 2.x the default is false. |
| _stay-quiesced_ | false | | `Enterprise` Introduced : 5.2 | 如果设置为 true，则该节点将 [quiesced](https://www.aerospike.com/docs/reference/info/index.html?show-removed=1#quiesce) 启动并保持静默状态。 他还将忽略 `quiesce-undo` 命令。有关何时使用此功能的详细信息，请参阅 [Quiescing a node](https://www.aerospike.com/docs/reference/info/index.html?show-removed=1#quiesce) 。|
| ~~transaction-duplicate-threads~~ | 0 | | Removed : 3.8.2.2 | 用于重复解析的工作线程。 |
| ~~transaction-queues~~ | #cpu | | Removed : 4.7 | 管理客户端请求的处理队列的数量。在版本 3.12 及更高版本中，默认情况下将其设置为可用的 CPU 内核数。在以前的版本中，默认值为 4 。服务线程会将 transaction 分派到这些队列中（round robin）。值范围 : 1 - 128。<br/> Tip : 典型的建议值是与主机上的 CPU 内核数量匹配。<br/> note ： 4.7版本统一 transaction 线程和 service 线程。从 4.7 版本开始，`service-threads`是唯一可用于控制网络线程和transaction 处理线程数量的配置选项。 |
| ~~use-queue-per-device~~ | false | | Removed : 3.11 | 指定要在每个设备上自动设置的队列编号。 | 
| user | | | | User to run as. <br/> 即使在创建日志文件之前也有效。 |
| _vault-ca_ | | | `Enterprise` Introduced : 5.1 | Aerospike 节点上 TLS 证书的路径，以使用 Vault 服务器进行身份验证。有关更多详细信息，请参见 [Vault integration](https://www.aerospike.com/docs/operations/configure/security/vault/index.html) 。|
| _vault-path_ | | | `Enterprise` Introduced : 5.1 | Vault 系统上存储的 secret 的路径。有关更多详细信息，请参见 [Vault integration](https://www.aerospike.com/docs/operations/configure/security/vault/index.html) 。 <br/> 警告：不要添加确切的 secret name 作为后缀；它作为 Aerospike 配置参数的值提供。 |
| _vault-token-file_ | | | `Enterprise` Introduced : 5.1 | Aerospike 节点上文件的路径，改文件包含用于标识 Vault 服务器的 Aerospike 服务器的 token。该 token 来自您的业务流程系统或 Vault 系统上的手动定义。有关更多详细信息，请参见 [Vault integration](https://www.aerospike.com/docs/operations/configure/security/vault/index.html) 。|
| _vault-url_ | | | `Enterprise` Introduced : 5.1 | Vault 服务的协议，域名或 IP 地址和端口。有关更多详细信息，请参见 [Vault integration](https://www.aerospike.com/docs/operations/configure/security/vault/index.html) 。|
| work-directory | /opt/aerospike | | | Aerospike 进程将使用该目录来存储所有元数据和系统文件。 <br/> note : 如果用户指定此目录，则 Aerospike 进程必须对该目录具有 读/写 权限。|
